<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="main.css">
    <title>Stundenplan-Planer</title>
</head>
<body onload="loadjson()">
<div id="table">
    <table>
        <tr>
            <td></td>
            <td>Montag</td>
            <td>Dienstag</td>
            <td>Mittwoch</td>
            <td>Donnerstag</td>
            <td>Freitag</td>
        </tr>
        <tr>
            <td>7</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>9</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>11</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>13</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>15</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>17</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
    </table>
</div>
<div id="list">
</div>
<!--<div id="buttons">
    <button>Neue Veranstaltung</button>
    <button>Exportieren</button>
    <button>Importieren</button>
</div>-->
</body>
<script>
    var model = undefined;

    function drawtable(t) {
        t.forEach(function (e, i) {
            e.forEach(function (e2, i2) {
                var zelle = document.getElementsByTagName("td")[(i2 + 1) * 6 + (i + 1)];
                var list = [];
                e2.forEach(function (e3) {
                    if (e3.Aktiv) {
                        list.push(e3)
                    }
                });
                var s = "";
                list.forEach(function (e) {
                    s += e.Name + "<hr>";
                });
                s = s.slice(0, s.length - 4);
                zelle.innerHTML = s;

            });
        });
    }

    function loadjson() {
        var table = [];
        for (var x = 0; x < 5; x++) {
            table[x] = [];
            for (var y = 0; y < 6; y++) {
                table[x][y] = [];
            }
        }
        var req = new XMLHttpRequest();
        req.open("GET", "module.json", true);
        req.onreadystatechange = function () {
            if (req.readyState == 4 && req.status == 200) {
                var modules = JSON.parse(req.responseText).module;
                model = modules;
                var list = document.getElementById("list");
                modules.forEach(function (e) {
                    var checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.name = "veranstaltung";
                    checkbox.value = e.Name;
                    checkbox.id = e.Name;
                    checkbox.checked = e.aktiv;
                    var label = document.createElement("label");
                    label.htmlFor = e.Name;
                    label.appendChild(document.createTextNode(e.Name));
                    list.appendChild(checkbox);
                    list.appendChild(label);
                    list.appendChild(document.createElement("br"));
                    e.Termine.forEach(function (termin) {
                        var x = -1;
                        switch (termin.Tag) {
                            case "Montag":
                                x = 0;
                                break;
                            case "Dienstag":
                                x = 1;
                                break;
                            case "Mittwoch":
                                x = 2;
                                break;
                            case "Donnerstag":
                                x = 3;
                                break;
                            case "Freitag":
                                x = 4;
                                break;
                        }
                        if (x != -1) {
                            var y = (termin.Start - 7) / 2;
                            table[x][y].push({Name: e.Name, Aktiv: e.aktiv});
                        }
                    });
                });
                drawtable(table);
            }
        };
        req.send();
    }
</script>
</html>